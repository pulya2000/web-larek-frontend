# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения
В проекте используется разновидность MV-архитектуры - MVP (Model-View-Presenter).

В коде приложения выделяются три слоя:
- Model
Модель отвечает за бизнес-логику приложения, управление данными и операции с данными,
такие как загрузка, сохранение и изменение данных. Модель не зависит от пользовательского интерфейса
и не содержит логику отображения, что делает ее переиспользуемой в различных интерфейсах.

- View
Представление (отображение) отвечает за отображение данных пользователю и взаимодействие с пользователем.
Оно получает данные, которые необходимо отобразить, от Presenter'а и просто реализует логику
их визуализации, без ведения каких-либо операций над данными.

- Presenter
Представитель действует как промежуточный слой между Моделью и Представлением.
Он реагирует на действия пользователя, вызовы из View, извлекает данные из Model и обрабатывает их
(например, может подготовить данные или преобразовать их в удобный для отображения формат).
После этого Presenter передает данные обратно в View.
Также Presenter отвечает за реализацию логики навигации между экранами или разделами приложения.

MVP-архитектура позволяет не связывать между собой модель и отображение. При этом представитель
использует и то, и другое, чтобы организовать работу между ними.

## Базовый код

### Класс EventEmitter
Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события. Класс имеет конструктор, который инициализирует события.
У конструктора нет параметров.
Свойства класса:
- `events: Map<EventName, set<Subscriber>>` - объект, содержащий все события
Методы класса, описаны интерфейсом IEvents:
- `on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие
- `off(eventName: EventName, callback: Subscriber): void` - отписка от события
- `emit<T extends object>(event: string, data?: T): void` - уведомление подписчиков о наступлении события
- `onAll(callback: (event: EmitterEvent) => void): void` - подписка на все события
- `offAll(): void` - сброс всех подписчиков
- `trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - генерация заданного события с заданными аргументами

### Класс API
Отвечает за работу с сервером, реализует отправку и получение запросов. Служит оберткой для упрощения и стандартизации отправки запросов и обработки ответов API.
Конструктор класса:
- `baseUrl: string` - базовый URL внешнего API
- `options: RequestInit` - опции для конфигурации запросов
Методы класса:
- `handleResponse(response: Response): Promise<object>` - обрабатывает ответ от API
- `get(uri: string): Promise<object>` - отправка 'GET'-запроса на сервер
- `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - отправка 'POST'-запроса на сервер

### Класс WebLarekAPI
Наследуется от класса API. Предназначен для получения данных с сервера и отправки заказа пользователя. Реализуется на основе интерфейса IWebLarekAPI.
Конструктор класса:
- `baseUrl: string` - базовый URL внешнего API
- `options: RequestInit` - опции для конфигурации запросов
Методы класса:
- `getProducts(uri: string): Promise<object>` - получает от сервера список продуктов 
- `getProductById(uri: string, id: string): Promise<object>` - получает от сервера данные конкретного продукта по его id
- `postOrder(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - отправляет на сервер заказ

### Абстрактные классы
### Класс Component
Используется в качестве основы для компонентов проекта, работающих с DOM-элементами.
Конструктор класса:
- `container: HTMLElement` - принимает DOM-элемент, который служит контейнером или корневым элементом для конкретного компонента.
Методы класса:
- `render(data?: Partial<T>): HTMLElement` - отрисовка DOM-элемента
- `setHidden(element: HTMLElement): void` - скрывает элемент
- `setVisible(element: HTMLElement): void` - делает элемент видимым
- `setDisabled(element: HTMLElement, state: boolean): void` - меняет состояние атрибута disabled у инпутов, делает элемент неактивным
- `setText(element: HTMLElement, value: unknown): void` - устанавливает текстовое содержимое заданного HTML элемента
- `setImage(element: HTMLElement, src: string, alt?: string): void` - устанавливает атрибуты src и alt для HTML элемента изображения
- `toggleClass(element: HTMLElement, className: string, force?: boolean): void` - добавляет или удаляет CSS класс у заданного HTML элемента

### Класс Model
Используется для управления данными и получения состояния модели, уведомляет об ее изменениях.
Конструктор класса:
- `data: Partial<T>, events: IEvents` - принимает начальные данные и параметры
Методы класса:
- `onChange(event: string, payload?: object): void` - уведомляет об изменении модели

## Компоненты модели данных
### Класс AppState
Наследуется от базового класса Model. Описывает глобальное состояние. Содержит данные и список действий других компонентов.
Свойства класса:
- `basket: IProduct[]` - данные о товарах в корзине
- `order: IOrder` - данные о заказе
- `catalog: IProductList` - список всех товаров
- `preview: string | null` - данные об id товара для предпросмотра
Методы класса:
- `addToBasket(id: string): void` - добавить товар в корзину
- `removeFromBasket(id: string): void` - удалить товар из корзины
- `clearBasket(): void` - очистить корзину
- `getTotalPrice(): number` - рассчитать итоговую стоимость товаров
- `setCatalog(products: IProduct[]): void` - обновляет список товаров, оповещает об изменениях в каталоге
- `setPreview(product: IProduct): void` - установка предварительного просмотра выбранного товара, оповещает об изменениях в состоянии

## Компоненты представления
Свойства и методы классов, их связи с другими компонентами представлены подробнее на UML-схеме.

### Класс MainPage
Отображает главную страницу приложения с корзиной и каталогом товаров. Наследуется от базового класса Component.
Конструктор класса:
- `container: HTMLElement, events: IEvents` - элемент DOM, который служит контейнером для компонента страницы, объект для обработки событий, позволяющий регистрировать и вызывать события
Свойства класса:
- `catalog: HTMLElement[]` - контейнер для списка(каталога) товаров 
- `basket: HTMLElement` - корзина
- `counter: number` - счетчик количества товаров в корзине
- `locked: boolean` - флаг, указывающий на блокировку страницы для пользовательских взаимодействий
Методы класса, сеттеры:
- `set catalog(products: HTMLElement[]): void` - установить список товаров
- `set counter(value: number): void` - установить значение счетчика в корзине
- `set locked(value: boolean): void` - блокирует или разблокирует интерфейс пользователя

### Класс ProductCard
Используется для отображения карточки товара, наследуется от класса Component.
Конструктор класса:
- `container: HTMLElement, actions?: ICardActions` 
Свойства класса:
- `description: HTMLElement` - описание товара
- `image: HTMLImageElement` - изображение товара
- `title: HTMLElement` - название товара
- `category: HTMLElement`- категория товара
- `price: HTMLElement` - стоимость товара
- `index: HTMLElement` - индекс товара
<!-- - button: HTMLButtonElement - кнопка на карточке товара -->
Методы класса, сеттеры и геттеры:
- `set id(value: string): void` - установить id товара
- `get id(): string` - получить id товара
- `set description(value: string | string[]): void` - установить описание товара
- `set image(value: string): void` - установить изображение товара 
- `set title(value: string): void` - установить название товара
- `get title(): string` - получить название товара
- `set category(value: string): void` - установить категорию товара
- `get category(): string` - получить категории товара
- `set price(value: number| null): void` - установить цену товара
- `get price(): number` - получить цену товара
- `set index(value: string): void` - установить индекса товара
- `get index(): string` - получить индекса товара
<!-- - set titleButton(value: string) - установить подпись кнопке
- buttonVisibility(value:number | null) - делает кнопку неактивной (если у товара нет стоимости) -->

### Класс Basket
Отображает список выбранных пользователем товаром, с возможностью их удаления из корзины, а также итоговую стоимость продуктов в корзине. Реализуется на основе интерфейса IBasket, наследуется от класса Component.
Конструктор класса:
- `container: HTMLElement, events: EventEmitter` - элемент DOM, который служит контейнером для компонента корзины, экземпляр EventEmitter для управления событиями
Свойства класса:
- `products: HTMLElement` - список товаров в корзине
- `total: HTMLElement` - итоговая стоимость товаров
- `button: HTMLElement` - кнопка для совершения действия с корзиной
Методы класса, сеттеры:
- `setDisabled(element: HTMLElement, disabled: boolean): void` - установить состояние кнопки в зависимости от параметра disabled
- `set products(products: HTMLElement[]): void` - установить элементы товаров в корзине
- `set total(total: number): void` - установить итоговую сумму товаров в корзине
- `set selected(products: string[])` - включить или отключить кнопку действия в зависимости от того, выбраны ли товары

### Класс Modal
Универсальный компонент для создания и управления модальными окнами в приложении. Используется для отображения различного контента в модальных окнах: изображений, текстовой информации, форм и так далее. Наследуется от класса Component.
Конструктор класса:
- `container: HTMLElement, events: IEvents` - элемент DOM, который служит контейнером для модального окна, экземпляр IEvents позволяет компоненту взаимодействовать с системой событий приложения
Свойства класса:
- `content: HTMLElement` - контейнер для содержимого модального окна
- `closeButton: HTMLButtonElement` - кнопка закрытия модального окна
Методы класса, сеттеры:
- `openModal(): void` - открыть модальное окно
- `closeModal(): void` - закрыть модальное окно
- `render(data: IModalData): HTMLElement` - расширяет аналогичный метод из Component, принимает и отрисовывает данные для отображения в модальном окне
- `set content(value: HTMLElement)` - установить HTML-содержимое модального окна

### Класс Form
Используется для создания и управления формами в приложении, реализовывает логику обработки данных формы, включая валидацию и обработку ошибок. Наследуется от класса Component, использует интерфейс IForm для управления состоянием формы (включая валидность) и ошибки ввода данных.
Конструктор класса:
- `container: HTMLElement, events: IEvents` - элемент DOM, который служит контейнером для элемента формы, экземпляр IEvents позволяет компоненту взаимодействовать с системой событий приложения
Свойства класса:
- `submit: HTMLButtonElement` - кнопка отправки формы
- `errors: HTMLElement` - отображение ошибок формы
Методы класса, сеттеры:
- `set isValid(value: boolean): void` - установить активность кнопки отправки формы на основе параметра value, который отражает валидность данных формы
- `set errors(value: string): void` - установить текст ошибок валидации
- `render(state: Partial<T> & IForm)` - расширяет аналогичный метод из Component, принимает состояние формы (в том числе валидность), сообщения об ошибках, текущие значения полей формы

### Класс Success
Отображает текстовое сообщение об успешной отправке заказа и итоговой сумме списания. Наследуется от класса Component.
Конструктор класса:
- `container: HTMLElement` - элемент DOM, который служит контейнером для компонента успешного события
Свойства класса:
- `close: HTMLElement` - элемент кнопки закрытия компонента успешного события
Методы класса, сеттеры:
- использует методы, унаследованные от базового класса Component, для управления состоянием и рендерингом
- `set totalPrice(value: string): void` - установить итоговую сумму списания за покупку 

------
#### Основные типы и интерфейсы проекта
-  IProduct - интерфейс, который представляет собой модель данных для товара. Содержит все необходимые свойства, которые описывают товар.
```
export interface IProduct { 
  id: string; // Уникальный идентификатор товара
  description: string;  // Описание товара
  image: string;  // Ссылка на изображение товара
  title: string; // Название товара
  category: string; // Категория, к которой относится товар
  price: number | null; // Цена товара. Может быть null, если цена не указана
}
```
- IProductList - интерфейс для представления списка товаров. Определяет структуру данных, содержащую массив товаров и общее количество товаров.
```
export interface IProductList {
  products: IProduct[]; // Массив товаров
  total: number; // Общее количество товаров
}
```
- TPayment - тип, определяющий допустимые значения методов оплаты.
```
export type TPayment = 'online' | 'cash';
```
- IOrderForm - интерфейс, представляющий форму заказа. Содержит данные, заполненные пользователем при оформлении заказа.
```
export interface IOrderForm {
  payment: TPayment; // Метод оплаты
  address: string; // Адрес доставки
  email: string; // Электронная почта покупателя
  phone: string; // Контактный телефон покупателя
}
```
- IOrder - интерфейс для заказа, расширяющий IOrderForm. Включает в себя форму заказа и дополнительные данные о заказе, такие как общая сумма и товары в заказе.
```
export interface IOrder extends IOrderForm {
  total: number | null; // Общая сумма заказа. Может быть null, если сумма еще не подсчитана
  products: IProduct[]; // Товары, включенные в заказ
}
```
- IOrderData - интерфейс для данных оформленного заказа. Содержит уникальный идентификатор заказа и итоговую сумму.
```
export interface IOrderData {
  id: string; // Уникальный идентификатор заказа
  total: number; // Итоговая сумма заказа
}
```
- IBasket - интерфейс для корзины. Описывает структуру данных корзины, включая список товаров и общую сумму.
```
export interface IBasket {
  products: IProduct[]; // Товары в корзине
  total: number | null; // Общая сумма товаров в корзине. Может быть null, если сумма не подсчитана  
}
```
- IWebLarekAPI - интерфейс API клиента. Определяет методы для взаимодействия с сервером, такие как получение списка товаров, получение товара по ID и отправка заказа.
```
export interface IWebLarekAPI {
  getProducts(): Promise<IProductList>; // Возвращает список товаров
  getProductById(id: string): Promise<IProduct>; // Возвращает товар по его ID
  postOrder(order: IOrder): Promise<IOrderData>; // Отправляет данные заказа на сервер и возвращает данные оформленного заказа
}
```
- IBasketModel - интерфейс модели данных корзины. Определяет методы для управления состоянием корзины, такие как добавление товара, удаление товара, очистка корзины и расчет общей стоимости товаров в корзине.
```
export interface IBasketModel {
  products: IProduct[]; // Товары в корзине
  addToBasket(id: string): void; // Добавляет товар в корзину по его ID
  removeFromBasket(id: string): void; // Удаляет товар из корзины по его ID
  clearBasket(): void; // Очищает корзину
  getTotalPrice(): number; // Возвращает общую стоимость товаров в корзине
}
```
- IOrderModel - интерфейс модели заказа. Расширяет интерфейс IOrder частичным образом, добавляя методы для задания адреса доставки, контактного телефона, адреса электронной почты и метода оплаты.
```
export interface IOrderModel extends Partial<IOrder> {
  addAddress(address: string): void; // Добавляет адрес доставки
  addPhone(phone: string): void; // Добавляет контактный телефон
  addEmail(email: string): void; // Добавляет адрес электронной почты
  addPayment(payment: TPayment): void; // Задает метод оплаты
}
```
- IProductCard - интерфейс для карточки товара. Расширяет интерфейс IProduct, добавляя шаблон карточки товара и метод для получения товара.
```
export interface IProductCard extends IProduct {
  cardTemplate: HTMLTemplateElement; // HTML-шаблон карточки товара для рендеринга в DOM
  getProduct(): void;  // Метод для загрузки или обновления данных о товаре, например, из API 
}
```
- IModalData - интерфейс для предоставления структуры содержимого модального окна. Используется для передачи данных при создании или управлении модальными окнами в приложении.
```
export interface IModalData {
  content: HTMLElement; // Контент, который будет отображаться в модальном окне. Может быть любым HTML-элементом
}
```
- ISuccessModal - интерфейс для данных, отображаемых в модальном окне после успешного создания заказа. Содержит всю необходимую информацию для отображения соответствующего уведомления пользователю.
```
export interface ISuccessModal {
  totalPrice: number; // Общая сумма заказа, которая была успешно оформлена
}
```
- IAppState - глобальный интерфейс состояния для всего приложения. Хранит важные данные, необходимые для работы разных компонентов приложения.
```
export interface IAppState {
  basket: IProduct[]; // Список товаров, добавленных в корзину
  order: IOrder; // Данные текущего оформленного заказа
  catalog: IProductList; // Данные каталога товаров, доступных в приложении
  preview: string | null; // URL-адрес для предварительного просмотра товара или null, если предварительный просмотр отсутствует
}
```
- IMainPage - интерфейс, характеризующий структуру и состояние главной страницы приложения. Используется для управления и интерактивности элементов на главной странице.
```
export interface IMainPage {
  catalog: HTMLElement[]; // Массив HTML-элементов, представляющих каталог товаров на главной странице
  basket: HTMLElement; // HTML-элемент, отображающий корзину с товарами
  counter: number; // Счетчик количества товаров в корзине
  locked: boolean; // Состояние блокировки главной страницы (например, во время обработки заказа или загрузки данных)
}
```
- IForm - интерфейс, определяющий структуру и состояние данных формы. Обеспечивает единый подход к валидации и управлению ошибками форм.
```
export interface IForm {
  isValid: boolean; // Флаг валидности данных формы
  errors: string[]; // Массив сообщений об ошибках, возникших в результате валидации
}
```